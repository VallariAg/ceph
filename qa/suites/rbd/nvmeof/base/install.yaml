use_shaman: True
tasks:
- install:
- cephadm:
- cephadm.shell:
    host.a:
    # get state before nvmeof deployment
    - ceph orch status
    - ceph orch ps
    - ceph orch host ls
    - ceph orch device ls
    - ceph osd lspools

- nvmeof:
    gateway_image: v0.0.6  # "default" uses packaged version; change to test specific nvmeof images, example "latest"
    cli_image: v0.0.6
    client: client.0
    gateway_config:
        source: host.a 
        target: client.1
        vars:
            pool_name: mypool
            image_name: myimage

- exec:
    client.0:
      - journalctl -u $(systemctl list-units | grep nvmeof.a | awk '{print $1}')

- workunit:
    no_coverage_and_limits: true
    clients:
      client.1:
        - rbd/nvmeof_initiator.sh

- nvmeof.basic_tests:
    client: client.1
