roles:
- - host.a
  - mon.a
  - mgr.x
  - osd.0
  - osd.1
  - client.0
  - ceph.nvmeof.nvmeof.a
- - host.b
  - mon.b
  - osd.2
  - osd.3
  - osd.4
  - client.1
  - ceph.nvmeof.nvmeof.b
- - client.2
- - client.3

tasks:
- nvmeof:
    client: client.0
    version: latest  # "default" uses packaged version; change to test specific nvmeof images, example "latest"
    rbd:
      pool_name: mypool
    gateway_config:
      namespaces_count: 10
      cli_version: latest

- cephadm.wait_for_service:
    service: nvmeof.mypool

- workunit:
    no_coverage_and_limits: true
    clients:
      client.2:
        - rbd/nvmeof_initiator.sh
        - rbd/nvmeof_basic_tests.sh
    env:
      RBD_POOL: mypool

- workunit:
    no_coverage_and_limits: true
    clients:
      client.3:
        - rbd/nvmeof_basic_tests.sh

- workunit:
    no_coverage_and_limits: true
    clients:
      client.2:
        - rbd/nvmeof_fio_test.sh 1 5
      client.3:
        - rbd/nvmeof_fio_test.sh 6 10
    env:
      IOSTAT_INTERVAL: '10'
