tasks:
- nvmeof:
    client: client.0
    version: default  # "default" uses packaged version; change to test specific nvmeof images, example "latest"
    rbd:
        pool_name: mypool
        image_name: myimage
    gateway_config:
        source: host.a 
        target: client.2
        vars:
            cli_version: latest

- cephadm.wait_for_service:
    service: nvmeof.mypool

- exec:
    client.0:
      - journalctl -u $(systemctl list-units | grep nvmeof.a | awk '{print $1}')

- workunit:
    no_coverage_and_limits: true
    clients:
      client.2:
        - rbd/nvmeof_initiator.sh
    env:
      RBD_POOL: mypool
      RBD_IMAGE: myimage

- nvmeof.basic_tests:
    client: client.2
    env:
      RBD_POOL: mypool
      RBD_IMAGE: myimage

- nvmeof.fio_test:
    client: client.2
    iostat_interval: 10 #sec
    conf:
        runtime: 600 #10 mins
        numjobs: 1
